
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Amazon Super Search â€“ Fixed</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify"></script>
</head>
<body>
  <h1>Amazon Super Search</h1>
  <form id="amazon-search-form">
    <label>Keyword:
      <input type="text" name="q" id="mainSearchInput">
    </label><br>
    <label>Min Price:
      <input type="number" name="min-price">
    </label><br>
    <label>Max Price:
      <input type="number" name="max-price">
    </label><br>
    <label>Brand Include:
      <input type="text" name="brand-include" id="brandInclude">
    </label><br>
    <label>Brand Exclude:
      <input type="text" name="brand-exclude" id="brandExclude">
    </label><br>
    <label>
      <input type="checkbox" name="prime-only"> Prime Only
    </label><br>
    <button type="submit">Search Amazon</button>
  </form>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    new Tagify(document.querySelector('input[name="brand-include"]'));
    new Tagify(document.querySelector('input[name="brand-exclude"]'));

    const form = document.getElementById('amazon-search-form');
    form.addEventListener('submit', function (e) {
      e.preventDefault();

      const data = new FormData(form);
      const params = new URLSearchParams();
      const rh = [];

      const min = data.get('min-price');
      const max = data.get('max-price');
      if (min && max) rh.push(`p_36:${Math.round(min * 100)}-${Math.round(max * 100)}`);
      else if (min) rh.push(`p_36:${Math.round(min * 100)}-`);
      else if (max) rh.push(`p_36:-${Math.round(max * 100)}`);

      const brandIncludeRaw = data.get('brand-include')?.trim();
      const brandExcludeRaw = data.get('brand-exclude')?.trim();
      if (brandIncludeRaw) {
        const brands = JSON.parse(brandIncludeRaw).map(obj => obj.value);
        brands.forEach(b => rh.push(`p_89:${encodeURIComponent(b)}`));
      }
      if (brandExcludeRaw) {
        const brands = JSON.parse(brandExcludeRaw).map(obj => obj.value);
        brands.forEach(b => params.append('brand-exclude', b));
      }

      if (data.get('prime-only') === 'on') {
        rh.push('p_n_prime:1000');
      }

      if (rh.length) params.set('rh', rh.join(','));
      params.set('tag', 'echolover25-20');

      const finalUrl = `https://www.amazon.com/s?${params.toString()}`;
      window.open(finalUrl, '_blank');
    });
  });
  </script>
</body>
</html>
